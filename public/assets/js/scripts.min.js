
$(function() {

	$(".form").parsley({

	 errorClass: 'is-invalid text-danger',

	 successClass: 'is-valid', // Comment this option if you don't want the field to become green when valid. Recommended in Google material design to prevent too many hints for user experience. Only report when a field is wrong.

	 errorsWrapper: '<span class="form-text text-danger"></span>',

	 errorTemplate: '<span></span>',

	 trigger: 'change'

	});

});


$('.form').submit(function(e) {
	var forms = $(this);
	flag = true;
	Parsley.on('form:success', function() {
	 
	 	if (flag) {
	 		flag = false;
			$.ajax({
		    type: forms.attr('method'),
		    url: forms.attr('action'),
		    data: forms.serialize()
		  }).done(function(res) {
		  	res = JSON.parse(res);
		  	if (res['success']) {
		  		$('.alert').find('div').text('Комментарий успешно отправлен!');
		  		$('.alert').addClass('alert-success');
		  	} else {
			    $('.alert').find('div').text('Ошибка при отправке комментария');
		    	$('.alert').addClass('alert-danger');
		  	}
		    $('.alert').show();
		    forms.trigger("reset");
		  }).fail(function(res) {
		    $('.alert').find('div').text('Ошибка при отправке комментария');
		    $('.alert').addClass('alert-danger');
		    $('.alert').show();
		  });
	  
		}

	});

  //отмена действия по умолчанию для кнопки submit
  e.preventDefault();
  return false;
});

$('.alert').on('closed.bs.alert', function () {
  $(this).removeClass('alert-error');
  $(this).removeClass('alert-success');
})
